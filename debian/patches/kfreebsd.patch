From 72f2433a854d7ff0ae62607dc0b7ead6232e521d Mon Sep 17 00:00:00 2001
From: Shawn Landden <shawnlandden@gmail.com>
Date: Mon, 9 Jul 2012 16:07:38 -0700
Subject: [PATCH] kfreebsd: support getsysinfo() on GNU/kFreeBSD

---
 kcutil.cc |    2 +-
 myconf.h  |    5 +++++
 2 files changed, 6 insertions(+), 1 deletion(-)

Index: kyoto-cabinet/kcutil.cc
===================================================================
--- kyoto-cabinet.orig/kcutil.cc
+++ kyoto-cabinet/kcutil.cc
@@ -324,7 +324,7 @@ void getsysinfo(std::map<std::string, st
       (*strmap)["mem_rss"] = strprintf("%lld", (long long)size);
     }
   }
-#elif defined(_SYS_FREEBSD_) || defined(_SYS_SUNOS_)
+#elif defined(_SYS_FREEBSD_) || defined(_SYS_SUNOS_) || defined(_SYS_GNUKFREEBSD_)
   _assert_(strmap);
   struct ::rusage rbuf;
   std::memset(&rbuf, 0, sizeof(rbuf));
Index: kyoto-cabinet/myconf.h
===================================================================
--- kyoto-cabinet.orig/myconf.h
+++ kyoto-cabinet/myconf.h
@@ -33,6 +33,11 @@
 #define _SYS_FREEBSD_
 #define _KC_OSNAME     "FreeBSD"
 
+#elif defined(__FreeBSD_kernel__) && defined(__GLIBC__)
+
+#define _SYS_GNUKFREEBSD_
+#define _KC_OSNAME     "GNU/kFreeBSD"
+
 #elif defined(__NetBSD__)
 
 #define _SYS_NETBSD_
